<%# app/views/tasks/index.html.erb %>
<div class="container mx-auto px-4 py-8">
  <div class="flex justify-between items-center mb-6">
    <h1 class="text-3xl font-bold text-gray-800">Meus Boards de Tarefas</h1>
    <%# Botão principal, agora com ID para ser controlado pelo Stimulus %>
    <%= link_to "Novo Board", new_board_path, class: "bg-blue-500 hover:bg-blue-700 text-white font-bold py-2 px-4 rounded-lg shadow-md transition duration-150 ease-in-out", id: "main_new_board_button" %>
  </div>

  <%# Container para a lista de boards e o placeholder de adicionar %>
  <div class="flex overflow-x-auto gap-6 pb-4" id="boards_list_container">
    <% @boards.each do |board| %>
      <%= render "boards/board", board: board %>
    <% end %>
    <%# Placeholder inicial para adicionar um novo board %>
    <%= render "boards/add_new_board_placeholder" %>
  </div>

  <% if @boards.empty? %> <%# Mensagem se não houver boards, mas o placeholder ainda está acima %>
    <div class="text-center py-10 mt-[-2rem]"> <%# Ajuste de margem para compensar o placeholder se ele estiver vazio %>
      <p class="text-xl text-gray-500">Nenhum board encontrado ainda.</p>
    </div>
  <% end %>
</div>

<%# Update the existing script to use turbo:load and a more robust target check %>
<script>
  document.addEventListener("turbo:load", function () {
    document.querySelectorAll(".task-item").forEach(function (taskEl) {
      taskEl.addEventListener("click", function (e) {
        // Prevent toggling if clicking on interactive elements
        if (e.target.closest("a, button, input, textarea, [data-action], .task-field")) return;

        const actions = taskEl.querySelector(".task-actions");
        if (!actions) return;

        actions.classList.toggle("hidden");
      });
    });

    // Nova lógica para o botão principal "Novo Board" ser gerenciado globalmente
    // Esta é uma forma de garantir que o botão principal fique visível se não houver
    // um processo de adição inline ativo.
    const mainButton = document.getElementById("main_new_board_button");
    if (mainButton) {
        // Se houver um elemento indicando adição em progresso (você precisaria definir isso),
        // mantenha-o escondido. Caso contrário, mostre.
        // Esta lógica pode ser mais bem gerenciada pelo Stimulus controller.
    }
  });
</script>